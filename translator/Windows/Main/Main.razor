<Layout>
    <Card Height="Height.Is100">
        <CardBody Height="Height.Is100" Display="Display.Flex.Column">
            <Row Flex="Flex.Grow.Is1">
                <Column ColumnSize="ColumnSize.Is12">
                    <div id="editor"/>
                </Column>
            </Row>
        </CardBody>
    </Card>
</Layout>

@inject TranslatorService Translator
@inject IJSRuntime JsRuntime

@code {
    private DotNetObjectReference<Main>? objRef;

    protected override void OnInitialized()
    {
        objRef = DotNetObjectReference.Create(this);
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender) {
            await JsRuntime.InvokeVoidAsync("TranslatorJs.saveMain", objRef);
            await JsRuntime.InvokeVoidAsync("TranslatorJs.loadEditor");
            Translator.ProgramUpdated += async (program) =>
            {
                await JsRuntime.InvokeVoidAsync("TranslatorJs.updateProgram", new[] { program });
            };
        }
    }

    [JSInvokable]
    public void UpdateProgram(string program)
    {
        Translator.Program = program;
    }
}
